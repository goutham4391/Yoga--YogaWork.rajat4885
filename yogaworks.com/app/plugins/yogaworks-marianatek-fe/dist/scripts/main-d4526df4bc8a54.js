!function(o){"use strict";o.validator.addMethod("pwcheck",function(e){return/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[\w\W]{8,}$/.test(e)}),o.validator.addMethod("emailcheck",function(e){return(void 0!==yahAjax.allowPlus&&yahAjax.allowPlus?/^([a-zA-Z0-9_.+-])+\@(?!-)+(([a-zA-Z0-9-])+[a-z0-9]\.)+([a-zA-Z0-9]{2,4})+$/:/^([a-zA-Z0-9_.-])+\@(?!-)+(([a-zA-Z0-9-])+[a-z0-9]\.)+([a-zA-Z0-9]{2,4})+$/).test(e)}),o.validator.addMethod("lettersOnly",function(e,t){return/^[a-z]+$/i.test(e)&&-1!==o.inArray(e.toUpperCase(),["AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY","AS","DC","FM","GU","MH","MP","PR","PW","VI"])}),o.validator.addMethod("zipUS",function(e){return/^\d{5}$/.test(e)}),o.validator.addMethod("dateFormat",function(e,t){var a=e.toString().split("/"),n=parseInt(a[0]),o=parseInt(a[1]),i=parseInt(a[2]),r=[31,28,31,30,31,30,31,31,30,31,30,31],a=!1;return(i%400==0||i%100!=0&&i%4==0)&&(r[1]=29),a=!(i<1900||i>(new Date).getFullYear()||0===n||12<n)&&(0<o&&o<=r[n-1]),this.optional(t)||/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(e)&&a},"MM/DD/YYYY"),o.validator.addMethod("ageCheck",function(e){var t,a,n,o;return t=e,a=new Date,n=new Date(t),o=a.getFullYear()-n.getFullYear(),((t=a.getMonth()-n.getMonth())<0||0==t&&a.getDate()<n.getDate())&&o--,18<=o}),o.validator.addMethod("ccExpCheck",function(e){var t=(new Date).getMonth()+1,a=(new Date).getFullYear(),n=void 0!==e?e.split("/"):[],e=void 0!==n[0]?parseInt(n[0].replace(/\s/g,"")):0,n=void 0!==n[1]?parseInt(n[1].replace(/\s/g,"")):0;return 0<e&&e<13&&(a<n||n===a&&t<=e)}),o.validator.addMethod("usState",function(e,t){return this.optional(t)||e.match(/^(A[LKSZRAEP]|C[AOT]|D[EC]|F[LM]|G[ANU]|HI|I[ADLN]|K[SY]|LA|M[ADEHINOPST]|N[CDEHJMVY]|O[HKR]|P[ARW]|RI|S[CD]|T[NX]|UT|V[AIT]|W[AIVY])$/i)});function n(){o.magnificPopup.instance.isOpen||o.magnificPopup.open({items:{src:_,type:"inline"},modal:!0})}function i(e){void 0!==e&&e?T.find(".dismiss-popup-btn").hide():T.find(".dismiss-popup-btn").show()}function r(e){T.find(".form-control").removeClass("error valid"),T.find("label.error").hide(),void 0!==e&&e&&(T.find("input:not([type=button],[type=submit],[type=hidden])").val(""),T.find("#agreed_terms").prop("checked",!1),T.find("#agreed-terms").prop("checked",!1)),V.html("")}function s(e){var t=o("[data-mt-my-account]"),a=o("[data-yw-promo-cta]");"object"==typeof e&&null!==e&&void 0!==e.fullName&&e.fullName?(t.find(".account-name").text(e.fullName),t.removeClass("d-none").addClass("d-inline-flex"),o("[data-mt-logout-btn]").addClass("pr-0"),a.addClass("d-none")):(t.addClass("d-none").removeClass("d-inline-flex"),a.removeClass("d-none"))}function d(e){e=void 0!==e&&e?e:"",j.find(".app-header-subtitle").html(e),j.show(),i(!0)}function c(){j.find(".app-header-subtitle").html("Loading..."),j.hide(),i(!1)}function l(e,t,a,n){var o;A.hide(),x.hide(),c(),M.show(),void 0!==e&&e&&((o=M.find(".app-header-title")).removeClass(de).removeClass(se),o.html(e).addClass(n)),void 0!==t&&t&&M.find(".app-header-subtitle").html(t),void 0!==a&&a&&M.find(".app-header-description").html(a)}function u(){A.show(),x.show(),M.hide()}function a(){A.hide(),M.hide(),x.hide()}function m(){return o.cookie(te)}function f(e){o.cookie(te,e,{expires:30,path:"/"})}function p(){f(""),s()}function h(e,t){"function"==typeof pe&&(d(),pe(),s(e.data))}function v(e,t){t=void 0!==t&&void 0!==t.subtitle?t.subtitle:"Login or create an account to continue.",A.removeClass("in-checkout-form"),c(),i(!1),u(),Y.hide(),U.hide(),I.show(),r(),A.hide(),N.html("Login"),O.html(t),pe=void 0!==e?e:pe,n()}function g(e){"undefined"!=typeof Stripe&&e&&(e=(we=Stripe(e)).elements({locale:"auto"}),(ye=e.create("card",{style:{base:{letterSpacing:"1px",fontSize:"16px","::placeholder":{color:"#8aa7a7"},":-webkit-autofill":{color:"#17aa9d"}},invalid:{color:"#ff0000","::placeholder":{color:"#FFCCA5"}}}})).mount(ve),ye.on("change",function(e){o(ve+"-error").html(e.error?e.error.message:"").show()}))}function w(e,t){var a;A.hide(),M.hide(),I.hide(),Y.hide(),U.hide(),V.html(""),Z.hide(),$.hide(),X.html(""),d("Loading Checkout..."),void 0!==e&&e?(e=e,a=function(e){u(),he=e.cartData,A.addClass("in-checkout-form"),N.html('<span class="subtitle">Start Your Checkout</span>'+e.title),E.html("Pay now "+e.cartTotalFormatted),X.html(me),Y.show(),c(),r(!0),V.html(""),R.html(""),void 0!==e.promoData&&void 0!==e.promoData.originalPrice&&R.html('<div class="promo-desc">'+e.promoData.promoMessage+'</div><span class="tag"><span>'+e.promoData.promoCode+'</span><img src="'+R.data("close-icon")+'" alt="remove promo code" data-promo-cancel-btn></span>'),G.find("span.span-label").hide(),("tt"===le?G.find("span.tt"):G.find("span.studio")).show(),void 0!==e.savedCard&&e.savedCard?($.find(".card-type").text(e.savedCard.cardType),$.find(".card-number").text(e.savedCard.lastFour),Z.hide(),$.show(),J.text("Use a new Credit Card").show(),ke=!0,J.on("click",function(){J.hide(),V.html(""),o(ve+"-error").html(""),o(this).hasClass("new-cc")?($.show(),Z.hide(),setTimeout(function(){J.removeClass("new-cc").text("Use a new Credit Card").show()},500),ke=!0):($.hide(),Z.show(),setTimeout(function(){J.addClass("new-cc").text("Use Saved Credit Card").show()},1e3),ke=!1,g(e.stripePaymentKey))})):(J.hide(),Z.show(),g(e.stripePaymentKey))},t=t,setTimeout(function(){d("Loading Checkout...")},500),t=void 0!==t?t:null,o.ajax({type:"POST",url:mtVars.ajaxUrl,data:{action:"mt_get_product_info",product_id:e,product_type:le,promoCode:t,isMembershipCheckout:fe,token:m(),location_id:ue,formcheck:T.data("get-product-formcheck")},dataType:"json",success:function(e){e.success&&"function"==typeof a?a(e.data):l(ie,re,e.data.message,de)},error:function(){l(ie,re,ae,de)}})):l(ie,re,"The Product ID was not found. Please check and try again.",de),n()}function y(t,a,e){d(),x.hide(),e=void 0!==e&&e?e:null;var n=fe&&ke||e?"mt_checkout":"mt_checkout_cart";o.ajax({type:"POST",url:mtVars.ajaxUrl,data:{action:n,cartData:he,useSavedCard:ke?1:0,formcheck:H.data("checkout-formcheck"),paymentData:e},dataType:"json",success:function(e){e.success&&"function"==typeof t?t(e.data):a(e.data.message)},error:function(){a(ae)}})}function k(t,a){var e=m();e?o.ajax({type:"POST",url:mtVars.ajaxUrl,data:{action:"at_mt_validate_token",token:e,formcheck:mtVars.formCheck},dataType:"json"}).done(function(e){e.success?(s(e.data),"function"==typeof t&&t()):(p(),"function"==typeof a&&a())}).fail(function(e,t){p(),"function"==typeof a&&a()}):"function"==typeof a&&a()}function C(e){var t=m();a(),setTimeout(function(){d("Attempting to make reservation")},500),t?o.ajax({type:"POST",url:mtVars.ajaxUrl,data:{action:"mt_reserve_class",token:t,classSessionId:e,formcheck:T.data("reserve-formcheck")},dataType:"json"}).done(function(e){e.success||void 0!==e.data.isReserved&&e.data.isReserved?o(window).trigger("refresh-reservations",[function(){l(oe,re,e.data.message,se)}]):l(ie,re,e.data.message,de)}).fail(function(e,t){l(ie,re,ae,de)}):l(ie,re,ae,de)}function b(e){var t=m();a(),setTimeout(function(){d("Attempting to cancel reservation")},500),t?o.ajax({type:"POST",url:mtVars.ajaxUrl,data:{action:"mt_cancel_reserve_class",token:t,reservationId:e,formcheck:T.data("reserve-formcheck")},dataType:"json"}).done(function(e){e.success?o(window).trigger("refresh-reservations",[function(){l(oe,re,e.data.message,se)}]):l(ie,re,e.data.message,de)}).fail(function(e,t){l(ie,re,ae,de)}):l(ie,re,ae,de)}function t(){k(function(){void 0!==ce&&ce&&w(ce)},function(){void 0!==ce&&ce&&v(function(){w(ce)})})}var e=o(document),_="#marianatek-app-popup",T=o(_),S="[data-mt-product-btn]",P="[data-mt-confirm-cancel-reserve-btn]",D=o(S+'[data-open-directly="1"]'),A=T.find(".app-header"),x=T.find(".app-main-content"),M=T.find(".app-notification"),j=T.find(".app-loading"),N=A.find(".app-header-title"),O=A.find(".app-header-description"),I=x.find(".app-forms.log-reg-form"),Y=x.find(".app-forms.checkout-form"),U=x.find(".app-forms.promo-form"),V=x.find(".error-message"),q=I.find(".log-reg-tabs li a"),F=I.find(".log-reg-tab-content"),L=I.find('form[name="mt-login-form"]'),z=I.find('form[name="mt-registration-form"]'),H=Y.find("#mt-payment-form"),E=H.find(".btn-submit-checkout-form"),R=H.find("[data-promo-wrap]"),K=H.find("#agreed-terms"),W=H.find("#agreed-terms-error"),Z=H.find("[data-checkout-new-card]"),$=H.find("[data-checkout-saved-card]"),J=H.find("[data-checkout-cc-switch]"),G=H.find("[data-checkout-term-label]"),X=H.find(".fine-print"),Q=x.find("[data-promo-code-popup-btn]"),B=U.find('form[name="mt-promo-form"]'),ee=U.find("[data-promo-apply-btn]"),te="_yw_mt__user_session",ae="Something went wrong! Please refresh the page and try again.",ne="You must agree to the terms of service before continuing.",oe="Congratulations!",ie="Something didn't go right.",re="YogaWorks",se="is-success",de="is-error",ce=D.data("product-id"),le=D.data("yw-type"),ue=D.data("location-id"),me=D.data("fine-print"),fe=0,pe=null,he=null,ve="#mt-card-element",ge="StripeElement--complete",we=null,ye=null,ke=!1,Ce={user_email:{required:!0,emailcheck:!0},password:{required:!0,pwcheck:!0,minlength:8},first_name:{required:!0},last_name:{required:!0},agreed_terms:{required:!0},cardnumber:"required"},be={user_email:{required:"Please enter your email address.",emailcheck:"Your email address must be in the format of name@domain.com"},password:{required:"Please enter your password.",pwcheck:"The password requires at least 8 characters with at least 1 number and 1 capital letter.",minlength:"The password requires at least 8 characters."},first_name:{required:"First name is required."},last_name:{required:"Last name is required."},agreed_terms:{required:"You must agree to the terms."}};D.remove(),t(),e.on("click",S,function(e){e.preventDefault();e=o(this);ce=e.data("product-id"),le=e.data("yw-type"),ue=e.data("location-id"),me=e.data("fine-print"),fe=parseInt(e.data("membership-checkout")),t()}),e.on("click","[data-mt-reserve-btn]",function(e){var t;e.preventDefault(),t=o(this).data("class-session-id"),a(),void 0!==t&&t?(d("Attempting to make reservation"),k(function(){C(t)},function(){v(function(){C(t)})})):l(ie,re,ae,de),n()}),e.on("click","[data-mt-cancel-reserve-btn]",function(e){e.preventDefault(),o.magnificPopup.instance.isOpen||o.magnificPopup.open({items:{src:"#marianatek-app-confirm-popup",type:"inline"},modal:!1}),o(P).data("reservation-id",o(this).data("reservation-id"))}),e.on("click",P,function(e){var t;e.preventDefault(),o.magnificPopup.instance.isOpen&&o.magnificPopup.close(),t=o(this).data("reservation-id"),a(),void 0!==t&&t?(d("Attempting to cancel reservation"),k(function(){b(t)},function(){v(function(){b(t)})})):l(ie,re,ae,de),n()}),L.validate({rules:Ce,messages:be,submitHandler:function(e,t){return t.preventDefault(),t={user_email:L.find('input[name="user_email"]').val(),password:L.find('input[name="password"]').val(),location_id:ue,action:L.data("action"),formcheck:L.data("formcheck")},x.hide(),d(),V.html(""),o.ajax({url:mtVars.ajaxUrl,dataType:"json",method:"POST",data:t}).always(function(){x.show(),c()}).done(function(e){e.success?(f(e.data.token),h(e)):(setTimeout(function(){c(),V.html(e.data.message)},500),p())}).fail(function(e,t){var e=void 0!==e.responseJSON?e.responseJSON:{},a=void 0!==e.message?e.message:ae,e=void 0!==e.data?e.data:{};void 0!==e.isNotification&&e.isNotification?l(ie,re,a,de):(setTimeout(function(){c(),V.html(a)},500),p())}),!1}}),z.validate({rules:Ce,messages:be,submitHandler:function(e,t){return t.preventDefault(),t={user_email:z.find('input[name="user_email"]').val(),password:z.find('[name="password"]').val(),first_name:z.find('[name="first_name"]').val(),last_name:z.find('[name="last_name"]').val(),location_id:ue,source:le,action:z.data("action"),formcheck:z.data("formcheck")},x.hide(),d(),V.html(""),i(!1),o.ajax({url:mtVars.ajaxUrl,dataType:"json",method:"POST",data:t}).always(function(){x.show(),c()}).done(function(e){e.success?(f(e.data.token),h(e)):(setTimeout(function(){c(),V.html(e.data.message)},500),p())}).fail(function(e,t){var e=void 0!==e.responseJSON?e.responseJSON:{},a=void 0!==e.message?e.message:ae;setTimeout(function(){c(),V.html(a)},500),p()}),!1}}),B.validate({rules:{promo_code:"required"},messages:{promo_code:"Please enter your promo code."},submitHandler:function(e,t){t.preventDefault();var a=H.find('input[name="promo_code"]');a.val();return ee.prop("disabled",!0),a.prop("disabled",!0),V.html(""),i(!0),o.ajax({type:"POST",url:mtVars.ajaxUrl,data:o(e).serialize(),dataType:"json",success:function(e){e.success?w(ce,e.data.promoCode):V.html(e.data.message),ee.prop("disabled",!1),a.prop("disabled",!1),i(!1)},error:function(){ee.prop("disabled",!1),a.prop("disabled",!1),V.html(ae),i(!1)}}),!1}}),H.on("submit",function(e){e.preventDefault();function t(e){var t,a;void 0!==e.error&&e.error?(V.html(void 0!==e.error.message&&e.error.message?e.error.message:ae),c(),A.show(),x.show()):fe?y(function(e){l(oe,re,e.message,se)},function(e){V.html(e),c(),x.show()},e.paymentMethod):(t=Math.ceil(10),(a=function(){A.hide(),x.hide(),d("Processing..."),o.ajax({type:"POST",url:mtVars.ajaxUrl,data:{action:"mt_get_payment_status",cartData:he,formcheck:H.data("payment-status-formcheck")},dataType:"json",success:function(e){0===--t?l(ie,re,ae,de):e.success?1===e.data.paymentStatus||0===e.data.isContinue?l(oe,re,e.data.message,se):a():l(ie,re,"Payment is processing but the payment status not available. For more information, reach out to our Customer Support.",de)},error:function(){l(ie,re,ae,de)}})})())}e=K.is(":checked");e&&(o(ve).hasClass(ge)||ke)?y(function(e){fe&&ke?l(oe,re,e.message,se):(e=e.clientSecret,fe?we.createPaymentMethod({type:"card",card:ye}).then(function(e){t(e)}):we.confirmCardPayment(e,{payment_method:{card:ye}}).then(function(e){t(e)}))},function(e){V.html(e),c(),x.show()}):(o(ve).hasClass(ge)||(o(ve).addClass("StripeElement--invalid"),o(ve+"-error").html("Card Number is required.").show()),e||W.html(ne).show())}),q.on("click",function(){var e=o(this),t=e.hasClass("active"),a=e.attr("aria-controls");t||(q.removeClass("active"),e.addClass("active"),F.find(".tab-pane").removeClass("active"),F.find("#"+a).addClass("active"),r(!0))}),K.on("change",function(){o(this).is(":checked")?W.html("").hide():W.html(ne).show()}),Q.on("click",function(e){e.preventDefault(),u(),A.removeClass("in-checkout-form"),N.html('<span class="subtitle">Promotional Code</span>'),O.html(""),Y.hide(),U.show(),B.find('input[name="cart_data"]').val(he)}),e.on("click","[data-promo-cancel-btn]",function(){w(ce)}),e.on("click",".dismiss-popup-btn",function(){o.magnificPopup.close()}),e.on("click",".btn-toggle-show-password",function(e){e.preventDefault();var t=o(this).find("span"),e="#"+o(this).data("field-id"),e=o(this).parent().find(e);"Hide"===t.html()?(t.html("Show"),e.attr("type","password")):(t.html("Hide"),e.attr("type","text"))}),e.on("click","[data-mt-logout-btn]",function(){var e;p(),ue=le=ce=pe=null,r(!(fe=0)),"function"==typeof e&&e(),o("#tab-login-btn").trigger("click"),l(oe,re,"You have been successfully logged out.",se),n(),s(null),o(window).trigger("refresh-reservations")})}(jQuery);